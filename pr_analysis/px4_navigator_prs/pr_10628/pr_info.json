{
  "title": "VTOL fix back transition navigation path for final MC stretch",
  "url": "https://github.com/PX4/PX4-Autopilot/pull/10628",
  "number": 10628,
  "created_at": "2018-10-02T21:26:30Z",
  "merged": false,
  "merged_at": null,
  "state": "closed",
  "conversation": {
    "author": "sanderux",
    "body": "Fixes https://github.com/PX4/Firmware/issues/10539\n\nInvalidates the previous setpoint (back transition itself).\n\nAlso skips the do_need_move_to_land as this step is always required and the variable acceptance radius could make it skip the final meters and make it start descent directly if the vtol_land waypoint is too close",
    "issue_comments": [
      {
        "author": "LorenzMeier",
        "created_at": "2018-10-03T07:56:14Z",
        "body": "@bresch Could you please review?",
        "type": "issue_comment"
      },
      {
        "author": "dagar",
        "created_at": "2018-10-03T14:16:45Z",
        "body": "Dropped do_need_move_to_land() is likely breaking FW.\r\n\r\n",
        "type": "issue_comment"
      },
      {
        "author": "dagar",
        "created_at": "2018-10-03T14:19:06Z",
        "body": " * fixes https://github.com/PX4/Firmware/issues/10590",
        "type": "issue_comment"
      },
      {
        "author": "dagar",
        "created_at": "2018-10-03T14:24:02Z",
        "body": "Could we please clarify the actual (intended) requirements with all of this mission logic? It's quite convoluted.\r\n\r\n### Intended Behaviour\r\n\r\n * When executing a landing mission item a multicopter should first move to the landing position at the current altitude. If already within the acceptance radius then start executing the landing immediately. \r\n",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2018-10-07T18:26:16Z",
        "body": "@dagar better?",
        "type": "issue_comment"
      },
      {
        "author": "RomanBapst",
        "created_at": "2018-10-16T09:09:42Z",
        "body": "@dagar Can we bring this in now? From what I understand changes to the navigator logic in this [PR](https://github.com/PX4/Firmware/pull/8749) have changed the behavior for VTOL doing back-transitions.\r\n At the moment I could not think of a better fix and even if I wanted to try it would involve a lot of time going through the navigator logic which has reached quite some level of complexity.\r\nSo unless you have a better idea I think we should merge this.",
        "type": "issue_comment"
      },
      {
        "author": "dagar",
        "created_at": "2018-10-16T12:18:46Z",
        "body": "Why does it make sense to mark the current position setpoint invalid, but not publish the updated triplet? ",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2018-10-17T15:18:28Z",
        "body": "Waiting for @RomanBapst for a better method",
        "type": "issue_comment"
      }
    ],
    "review_comments": [
      {
        "author": "dagar",
        "created_at": "2018-10-03T14:17:10Z",
        "body": "Comment explaining why?",
        "path": "src/modules/navigator/mission.cpp",
        "position": 8,
        "type": "review_comment"
      },
      {
        "author": "dagar",
        "created_at": "2018-10-03T14:18:01Z",
        "body": "Regular FW implications?",
        "path": "src/modules/navigator/mission.cpp",
        "position": 1,
        "type": "review_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2018-10-03T21:24:54Z",
        "body": "The acceptance radius on a vtol_land is assigned dynamically based on ground speed. It does this to estimate the distance where it should start the back transition.\r\n\r\nFor a fixed wing the default acceptance radius is used. The do_need_move_to_land would result in skipping the workitem that sets the intermediate waypoint to navigate towards the land site before commencing landing. It would only be skipped if the fixed wing was already withing the acceptance radius of the land waypoint when it got to that waypoint. Even if this would happen (which would be very odd) and we remove this condition it would only result in setting the nav item and directly accepting it as done.\r\n\r\nI do not see how this could affect a fixed wing mission in reality. Let me know if you think it can.",
        "path": "src/modules/navigator/mission.cpp",
        "position": 1,
        "type": "review_comment"
      }
    ],
    "reviews": [
      {
        "author": "RomanBapst",
        "created_at": "",
        "body": "",
        "state": "APPROVED",
        "type": "review"
      }
    ]
  }
}