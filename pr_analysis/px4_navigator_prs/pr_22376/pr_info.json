{
  "title": "Remove LNDMC_ALT_MAX",
  "url": "https://github.com/PX4/PX4-Autopilot/pull/22376",
  "number": 22376,
  "created_at": "2023-11-15T14:03:51Z",
  "merged": true,
  "merged_at": "2023-11-20T13:52:35Z",
  "state": "closed",
  "conversation": {
    "author": "MaEtUgR",
    "body": "### Solved Problem\r\nWhen discussing with @sfuhrer about geofence improvements he mentioned again the overlap between `LNDMC_ALT_MAX` and `GF_MAX_VER_DIST`. I know @dagar was bringing this up many times.\r\n\r\nI think now is the right time to remove it since I'm not aware who is using that functionality right now and @sfuhrer is working on geofence improvements which should allow us to forward users to using `GF_MAX_VER_DIST`.\r\n\r\nFixes #13345\r\n\r\n### Solution\r\nI remove `LNDMC_ALT_MAX` completely.\r\nIt was introduced here: https://github.com/PX4/PX4-Autopilot/pull/6679\r\nextended to shift down mission items here: https://github.com/PX4/PX4-Autopilot/pull/8048\r\n\r\n### Changelog Entry\r\n```\r\nCleanup: Remove LNDMC_ALT_MAX, use GF_MAX_VER_DIST instead\r\n```\r\n\r\n### Alternatives\r\nWe could use `GF_MAX_VER_DIST` in place of how `LNDMC_ALT_MAX` is currently used but:\r\n- On multicopter it prevents breaching the altitude in any climb rate enabled mode which we should achieve with the geofence.\r\n- On any vehicle, all mission items just get silently repositioned to be lower which was a hack to still allow RTL even if the return altitude is higher than the allowed altitude but flying lower than planned is not generally a safe thing to do. The check for the return altitude being lower than the maximum altitude should be done explicitly.\r\n\r\n### Test coverage\r\nI did not specifically test this but the functionality was removed and it still compiles.",
    "issue_comments": [
      {
        "author": "sfuhrer",
        "created_at": "2023-11-15T14:39:34Z",
        "body": "Note: this would require a docs update (remove deprecated param).",
        "type": "issue_comment"
      },
      {
        "author": "MaEtUgR",
        "created_at": "2023-11-20T13:59:18Z",
        "body": "> this would require a docs update\r\n\r\nIt was actually never documented explicitly but only in the autogenerated reference ðŸ˜… \r\n\r\n![image](https://github.com/PX4/PX4-Autopilot/assets/4668506/4b118d52-fc5a-47a2-83a9-8e4276da1dce)\r\n",
        "type": "issue_comment"
      },
      {
        "author": "DronecodeBot",
        "created_at": "2024-07-25T01:09:07Z",
        "body": "This pull request has been mentioned on **Discussion Forum for PX4, Pixhawk, QGroundControl, MAVSDK, MAVLink**. There might be relevant details there:\n\nhttps://discuss.px4.io/t/px4-v1-15-public-changes-what-needs-docs/39850/1\n",
        "type": "issue_comment"
      }
    ],
    "review_comments": [],
    "reviews": [
      {
        "author": "sfuhrer",
        "created_at": "",
        "body": "For me this is a second implementation of a geofence feature, and thus support its removal. \r\nIf manufacturers want to implement a hard altitude limit that the user cannot overwrite then they can set GF_MAX_VER_DIST and GF_ACTION and do not give the user the ability to change them.",
        "state": "APPROVED",
        "type": "review"
      }
    ]
  }
}