{
  "title": "Navigator: set cruise_speed to default on entering new mode",
  "url": "https://github.com/PX4/PX4-Autopilot/pull/21503",
  "number": 21503,
  "created_at": "2023-04-21T15:24:37Z",
  "merged": true,
  "merged_at": "2023-05-05T13:53:17Z",
  "state": "closed",
  "conversation": {
    "author": "sfuhrer",
    "body": "Follow up on https://github.com/PX4/PX4-Autopilot/pull/21414.\r\n\r\nThe resets in the modes (eg Loiter mode) are not active yet, so manually set rep->current.cruising_speed = -1.f if not already in the same flight mode.\r\n\r\n\r\n### Test coverage\r\nSITL and flight tested on VTOLs.\r\n\r\n\r\n",
    "issue_comments": [
      {
        "author": "sfuhrer",
        "created_at": "2023-05-05T12:38:16Z",
        "body": "@RomanBapst this is needed because the [Navigator sets the the speed setpoint of the current position_setpoint based on the currently set cruising speed](https://github.com/PX4/PX4-Autopilot/blob/40324b03f4acc8eb49423b4e12b585a0cabfd713/src/modules/navigator/navigator_main.cpp#L285) before the [stored cruising speed is reset by the mode. ](https://github.com/PX4/PX4-Autopilot/blob/40324b03f4acc8eb49423b4e12b585a0cabfd713/src/modules/navigator/loiter.cpp#L68)\r\nSee the printfs when I change the speed in a mission and then switch into Hold mode:\r\n```\r\nget_cruising_speed(): 20.000000\r\nrest cruising speed\r\n```\r\n",
        "type": "issue_comment"
      }
    ],
    "review_comments": [],
    "reviews": [
      {
        "author": "RomanBapst",
        "created_at": "",
        "body": "",
        "state": "APPROVED",
        "type": "review"
      }
    ]
  }
}