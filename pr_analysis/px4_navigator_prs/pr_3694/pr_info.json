{
  "title": "Vtol weathervane",
  "url": "https://github.com/PX4/PX4-Autopilot/pull/3694",
  "number": 3694,
  "created_at": "2016-02-07T12:58:03Z",
  "merged": false,
  "merged_at": null,
  "state": "closed",
  "conversation": {
    "author": "RomanBapst",
    "body": "Fixes: https://github.com/PX4/Firmware/issues/3679\n",
    "issue_comments": [
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T14:18:59Z",
        "body": "After reviewing this further, I believe we should clamp the yaw control demand, instead of disabling it completely. So that the system does only spend a little effort in maintaining heading. In light wind it will then maintain it, in heavy wind it will weather-vane.\n",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2016-02-07T15:43:10Z",
        "body": "@LorenzMeier i agree, now it might be hard to understand what is going on in low wind conditions. How, and with what threshold should it disable control?\n",
        "type": "issue_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T15:52:59Z",
        "body": "10-20% of the maximum yaw demand might make sense, that would be 0.1-0.2 (you have to limit -0.2..0.2, since its symmetric around zero). That matches the intent to not give up too much control over roll and pitch for yaw.\n",
        "type": "issue_comment"
      },
      {
        "author": "RomanBapst",
        "created_at": "2016-02-07T16:49:33Z",
        "body": "@LorenzMeier @sanderux I need to check the mixer if this would even make any sense. I believe yaw is mixed in at the very end so that it doesn't violate thrust, roll, pitch\n",
        "type": "issue_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T16:52:34Z",
        "body": "@tumbili This discussion is not about yaw handling. Its about orienting the plane into the wind so that wind gusts do not completely ruin the position and attitude control response. Its very different from mixer limits.\n\nWe reserved a minimum for yaw. And it would put the motors at their maximum spread. It would mean that you would see the system constantly yaw in wind, coupled with roll and pitch. Two motors would run at their maximum capacity and overheat. We can't handle this on a best-effort basis in the mixer. We need to do this in the controller already, like Sander proposed.\n",
        "type": "issue_comment"
      },
      {
        "author": "tubeme",
        "created_at": "2016-02-07T19:32:42Z",
        "body": "This will apply only to QuadPlanes (classic plane with tail and rudder) not the quad delta wings, right? \n",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2016-02-07T20:14:26Z",
        "body": "@tubeme \nIt will apply to all VTOL types where the setting is enabled. if you have a standard vtol on delta wing i would suggest leaving the VT_OPT_WV_LND set to 0 (default).\n",
        "type": "issue_comment"
      },
      {
        "author": "tubeme",
        "created_at": "2016-02-07T20:56:53Z",
        "body": "@sanderux OK I understand. Thanks.\n",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2016-02-07T21:20:11Z",
        "body": "@LorenzMeier is this more what you had in mind?\n",
        "type": "issue_comment"
      },
      {
        "author": "sanderux",
        "created_at": "2016-02-09T01:37:37Z",
        "body": "Replaced by https://github.com/PX4/Firmware/pull/3706\n",
        "type": "issue_comment"
      }
    ],
    "review_comments": [
      {
        "author": "RomanBapst",
        "created_at": "2016-02-07T12:59:09Z",
        "body": "@sanderux Make sure to condition this on auto mode!\n",
        "path": "src/modules/mc_pos_control/mc_pos_control_main.cpp",
        "position": 37,
        "type": "review_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T13:24:26Z",
        "body": "whitespace error\n",
        "path": "src/modules/navigator/mission_block.cpp",
        "position": 1,
        "type": "review_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T13:28:22Z",
        "body": "We probably need to add the ability to add only ORB_IDs. This fix won't work properly because now the length of the struct is not necessarily equal.\n",
        "path": "src/modules/vtol_att_control/vtol_att_control_main.h",
        "position": 1,
        "type": "review_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T14:13:51Z",
        "body": "Add the condition here: `!_control_mode.flag_control_manual_enabled &&` then you should be safe.\n",
        "path": "src/modules/mc_pos_control/mc_pos_control_main.cpp",
        "position": 1,
        "type": "review_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T14:15:46Z",
        "body": "This is not the right way to do this. You can get into an increasing yaw rate this way. A simple wind gust would be sufficient to start the spiral of death. What you should do instead is to clamp the actuator control output for yaw.\n",
        "path": "src/modules/mc_att_control/mc_att_control_main.cpp",
        "position": 1,
        "type": "review_comment"
      },
      {
        "author": "LorenzMeier",
        "created_at": "2016-02-07T14:16:44Z",
        "body": "It will look funny if the system is constantly yawing on land. It should instead be \"soft yaw control\" or something like that.\n",
        "path": "src/modules/navigator/mission_block.cpp",
        "position": 1,
        "type": "review_comment"
      }
    ],
    "reviews": []
  }
}